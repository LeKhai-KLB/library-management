USE master
GO 
IF DB_ID('LIBRARY_MANAGEMENT') IS NOT NULL
	BEGIN
		PRINT 'Da co du lieu'
		DROP DATABASE LIBRARY_MANAGEMENT
	END
GO
CREATE DATABASE LIBRARY_MANAGEMENT

GO 
USE LIBRARY_MANAGEMENT

--------------------------------
----------TẠO CÁC BẢNG----------
--------------------------------
GO 
IF  EXISTS(SELECT * FROM INFORMATION_SCHEMA.TABLES Where Table_Schema = 'dbo'  AND Table_Name ='CATEGORY')
    DROP TABLE CATEGORY
GO
CREATE TABLE CATEGORY(
	Title NVARCHAR(50) PRIMARY KEY
)

GO 
IF  EXISTS(SELECT * FROM INFORMATION_SCHEMA.TABLES Where Table_Schema = 'dbo'  AND Table_Name ='LIBRARIAN')
    DROP TABLE LIBRARIAN
GO
CREATE TABLE LIBRARIAN(
	LibID INT PRIMARY KEY NOT NULL,
	LibName NVARCHAR(50) UNIQUE NOT NULL,
	LibPass VARCHAR(50) NOT NULL,
	LibPhone CHAR(10) UNIQUE NOT NULL
)

GO 
IF  EXISTS(SELECT * FROM INFORMATION_SCHEMA.TABLES Where Table_Schema = 'dbo'  AND Table_Name ='READER')
    DROP TABLE READER
GO
CREATE TABLE READER(
	ReID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	ReName NVARCHAR(50) NOT NULL,
	ReAddress NVARCHAR(100) NOT NULL,
	RePhone CHAR(10) NOT NULL,
	ReImage IMAGE NOT NULL
)

GO 
IF  EXISTS(SELECT * FROM INFORMATION_SCHEMA.TABLES Where Table_Schema = 'dbo'  AND Table_Name ='BOOK')
    DROP TABLE BOOK
GO
CREATE TABLE BOOK(
	ISBN CHAR(13) PRIMARY KEY NOT NULL,
	BookName NVARCHAR(50) NOT NULL,
	Author NVARCHAR(100) NOT NULL,
	Publisher NVARCHAR(50) NOT NULL,
	Quantity INT NOT NULL,
	Category NVARCHAR(50) NOT NULL DEFAULT N'All',
	Summary NVARCHAR(1500) NOT NULL,
	BookImage Image NOT NULL
)
GO
ALTER TABLE BOOK
ADD CONSTRAINT FK_CATEGORY_BOOK
FOREIGN KEY(Category) REFERENCES CATEGORY(Title)
ON DELETE SET DEFAULT
ON UPDATE CASCADE

GO 
IF  EXISTS(SELECT * FROM INFORMATION_SCHEMA.TABLES Where Table_Schema = 'dbo'  AND Table_Name ='ISSUEBOOK')
    DROP TABLE ISSUEBOOK
GO
CREATE TABLE ISSUEBOOK(
	IssueID INT PRIMARY KEY IDENTITY(1,1) NOT NULL,
	IssueBook CHAR(13) NOT NULL,
	IssueReader INT NOT NULL,
	IssueDate DATETIME NOT NULL,
)

GO
ALTER TABLE ISSUEBOOK
ADD CONSTRAINT FK_BOOK_ISSUE
FOREIGN KEY(IssueBook) REFERENCES BOOK(ISBN)
ON DELETE CASCADE
ON UPDATE CASCADE

GO
ALTER TABLE ISSUEBOOK
ADD CONSTRAINT FK_READER_ISSUE
FOREIGN KEY(IssueReader) REFERENCES READER(ReID)
ON DELETE CASCADE
ON UPDATE CASCADE

GO 
IF  EXISTS(SELECT * FROM INFORMATION_SCHEMA.TABLES Where Table_Schema = 'dbo'  AND Table_Name ='RETURNBOOK')
    DROP TABLE RETURNBOOK
GO
CREATE TABLE RETURNBOOK(
	ReturnID INT PRIMARY KEY NOT NULL,
	ReturnDate DATETIME NOT NULL
)

GO
ALTER TABLE RETURNBOOK
ADD CONSTRAINT FK_ISSUE_RETURN
FOREIGN KEY(ReturnID) REFERENCES ISSUEBOOK(IssueID)